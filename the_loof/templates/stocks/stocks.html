<section id="stocks-section" class="related-tickers">
  <div class="block-title d-flex justify-content-between">
    <h2>Stocks</h2>
    <div id="shuffle-stocks-btn" class="d-flex align-items-center"><icon class="fa fa-sync-alt"></div>
  </div>
  <div class="container">
    <div class="row">
      {% for stock in stock_list%}
      <div class="ticker-row border-top col-sm-6 col-lg-12 left">
        <div>
          <h4>{{ stock.company_name }}</h4>
          <h4>
            {% if stock.website %}
            <a href="{{ stock.website }}">
              <span class="symbol">{{ stock.symbol }}</span>
            </a>
            {% else %}
            <span class="symbol">{{ stock.symbol }}</span>
            {% endif %}
          </h4>
          <aside class="price-quote-container">
            <h4 class="current-price">${{ stock.current_price }}</h4>
            <h4
              class="price-change-amount {% if stock.change > 0 %} price-pos {% else %} price-neg {% endif %}"
            >
              ${{ stock.change }}
            </h4>
            <h4
              class="price-change-percent {% if stock.change > 0 %} price-pos {% else %} price-neg {% endif %}"
            >
              ({{ stock.percent_change | floatformat:3 }}%)
            </h4>
          </aside>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
</section>

{% block javascript %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>
  $("#shuffle-stocks-btn").click(function (e) {
    $.ajax({
      type: 'GET',
      url: '{% url "public:shuffle_stocks" %}',
      data: {
        csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
      },
      success: function (el) {
        $('#stocks-section').replaceWith(el)
      },
      error: function (xhr, errmsg, err) {
        console.log(errmsg);
      },
    });
  });
</script>
{% endblock javascript %}

